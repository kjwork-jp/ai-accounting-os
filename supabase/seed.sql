-- ============================================
-- Seed SQL: AI Business Accounting OS
-- 対象: マスタテーブル (m_*) + 初期テナント + 設定
-- 実行順序: 独立マスタ → テナント → 設定 → 勘定科目
-- 冪等性: ON CONFLICT DO NOTHING（何度実行しても安全）
-- ============================================

-- ============================================
-- 1. 証憑種別マスタ (m_document_types)
-- ============================================
INSERT INTO public.m_document_types (code, name) VALUES
  ('invoice',        '請求書'),
  ('receipt',        '領収書'),
  ('quotation',      '見積書'),
  ('contract',       '契約書'),
  ('bank_statement', '銀行明細'),
  ('credit_card',    'クレカ明細'),
  ('other',          'その他')
ON CONFLICT (code) DO NOTHING;

-- ============================================
-- 2. 税区分マスタ (m_tax_codes)
-- ============================================
INSERT INTO public.m_tax_codes (code, name, tax_rate, is_taxable) VALUES
  ('TAX10',  '課税10%',        10.00, true),
  ('TAX8',   '課税8%（軽減）',   8.00, true),
  ('NONTAX', '非課税',           0.00, false),
  ('EXEMPT', '免税',             0.00, false)
ON CONFLICT (code) DO NOTHING;

-- ============================================
-- 3. 決裁種別マスタ (m_approval_types)
-- ============================================
INSERT INTO public.m_approval_types (code, name) VALUES
  ('payment',        '支払申請'),
  ('expense',        '経費申請'),
  ('reimbursement',  '立替精算'),
  ('partner_change', '取引先登録/変更申請')
ON CONFLICT (code) DO NOTHING;

-- ============================================
-- 4. 初期テナント（開発/テスト用）
-- ============================================
INSERT INTO public.tenants (id, name, plan, status) VALUES
  ('00000000-0000-0000-0000-000000000001', '開発用テナント', 'free', 'active')
ON CONFLICT (id) DO NOTHING;

-- ============================================
-- 5. テナント設定（デフォルト値）
-- ============================================
INSERT INTO public.tenant_settings (
  tenant_id, auto_confirm_high, auto_confirm_mid, ai_daily_cost_limit_jpy
) VALUES (
  '00000000-0000-0000-0000-000000000001', 0.90, 0.70, 0
)
ON CONFLICT (tenant_id) DO NOTHING;

-- ============================================
-- 6. 勘定科目マスタ（開発テナント用 35科目）
-- ============================================
INSERT INTO public.m_accounts (
  tenant_id, code, name, category, parent_code, is_active
) VALUES
  -- 資産 (asset) 11科目
  ('00000000-0000-0000-0000-000000000001', '1100', '現金',         'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1110', '普通預金',     'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1120', '当座預金',     'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1200', '売掛金',       'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1300', '未収入金',     'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1400', '前払費用',     'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1500', '仮払金',       'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1600', '立替金',       'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1710', '仮払消費税',   'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1800', '固定資産',     'asset',     NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '1810', '工具器具備品', 'asset',     '1800', true),
  -- 負債 (liability) 7科目
  ('00000000-0000-0000-0000-000000000001', '2100', '買掛金',       'liability', NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '2200', '未払金',       'liability', NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '2300', '未払費用',     'liability', NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '2400', '前受金',       'liability', NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '2500', '預り金',       'liability', NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '2600', '仮受消費税',   'liability', NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '2700', '短期借入金',   'liability', NULL,   true),
  -- 純資産 (equity) 2科目
  ('00000000-0000-0000-0000-000000000001', '3100', '資本金',       'equity',    NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '3200', '利益剰余金',   'equity',    NULL,   true),
  -- 収益 (revenue) 3科目
  ('00000000-0000-0000-0000-000000000001', '4100', '売上高',       'revenue',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '4200', '受取手数料',   'revenue',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '4300', '雑収入',       'revenue',   NULL,   true),
  -- 費用 (expense) 12科目
  ('00000000-0000-0000-0000-000000000001', '5100', '仕入高',       'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5200', '外注費',       'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5300', '給与手当',     'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5400', '法定福利費',   'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5500', '通信費',       'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5600', '旅費交通費',   'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5700', '広告宣伝費',   'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5800', '消耗品費',     'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '5900', '接待交際費',   'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '6100', '減価償却費',   'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '6200', '支払手数料',   'expense',   NULL,   true),
  ('00000000-0000-0000-0000-000000000001', '6300', '雑損失',       'expense',   NULL,   true)
ON CONFLICT (tenant_id, code) DO NOTHING;

-- ============================================
-- 確認
-- ============================================
SELECT 'Seed completed' AS result;
